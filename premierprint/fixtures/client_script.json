[
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Stock Entry",
  "enabled": 1,
  "modified": "2025-12-19 16:56:18.771414",
  "module": null,
  "name": "Stock Entry - hide options",
  "script": "frappe.ui.form.on('Stock Entry', {\n    refresh: function(frm) {\n        // Faqat biz xohlagan variantlarni qoldiramiz\n        // Boshqa hamma narsani filtrlab tashlaymiz\n        frm.set_query('stock_entry_type', function() {\n            return {\n                filters: [\n                    ['Stock Entry Type', 'name', 'in', ['Расход по заказу', 'Услуги по заказу']]\n                ]\n            };\n        });\n    }\n});",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Stock Entry",
  "enabled": 1,
  "modified": "2025-12-21 11:20:16.842014",
  "module": null,
  "name": "stock entry - add item",
  "script": "frappe.ui.form.on('Stock Entry', {\n    // 1. FORM OCHILGANDA YOKI YANGILANGANDA\n    refresh: function(frm) {\n        // Dropdown filtrini o'rnatamiz\n        frm.set_query(\"custom_sales_order_item\", function() {\n            // Hozirgi tanlangan Sales Orderni olamiz\n            let so_id = frm.doc.custom_sales_order; // <-- MUHIM O'ZGARISH\n\n            if (!so_id) {\n                return { filters: { \"parent\": \"null\" } };\n            }\n\n            return {\n                // Python funksiya manzili\n                // DIQQAT: Agar sening papkang 'apps/premierprint/premierprint/utils/...' bo'lsa:\n                query: \"premierprint.utils.stock_entry.get_sales_order_items_query\",\n                filters: {\n                    \"sales_order\": so_id\n                }\n            };\n        });\n    },\n\n    // 2. SALES ORDER O'ZGARSA\n    custom_sales_order: function(frm) {\n        // Item maydonini tozalaymiz\n        frm.set_value(\"custom_sales_order_item\", \"\");\n        frm.clear_table(\"items\");\n        frm.refresh_field(\"items\");\n        \n        // Filtr avtomatik yangilanadi (chunki set_query da frm.doc.custom_sales_order bor)\n    },\n\n    // 3. ITEM TANLANGANDA\n    custom_sales_order_item: function(frm) {\n        if (frm.doc.custom_sales_order_item) {\n            \n            frm.clear_table(\"items\");\n            frm.refresh_field(\"items\");\n\n            frappe.call({\n                // Python funksiya manzili (2 qavatli papka strukturasi uchun)\n                method: \"premierprint.utils.stock_entry.get_bom_materials\",\n                args: {\n                    sales_order_item_id: frm.doc.custom_sales_order_item\n                },\n                freeze: true,\n                freeze_message: __(\"BOM yuklanmoqda...\"),\n                callback: function(r) {\n                    if (r.message && r.message.length > 0) {\n                        r.message.forEach(function(row) {\n                            let child = frm.add_child(\"items\");\n                            frappe.model.set_value(child.doctype, child.name, row);\n                        });\n                        frm.refresh_field(\"items\");\n                        frappe.show_alert({message: __(\"Materiallar qo'shildi\"), indicator: 'green'});\n                    } else {\n                        frappe.msgprint({\n                            title: __(\"Diqqat\"),\n                            message: __(\"Tanlangan mahsulot uchun BOM topilmadi.\"),\n                            indicator: 'orange'\n                        });\n                    }\n                }\n            });\n        }\n    }\n});",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Purchase Order",
  "enabled": 1,
  "modified": "2025-12-16 17:45:03.598740",
  "module": "Primier Print",
  "name": "Purchase Order",
  "script": "frappe.ui.form.on(\"Purchase Order\", {\n    before_save(frm) {\n        (frm.doc.items || []).forEach(row => {\n            if (!row.schedule_date) {\n                row.schedule_date = frappe.datetime.get_today();\n            }\n        });\n    },\n\n    refresh(frm) {\n        if (frm.fields_dict.items?.grid) {\n            const grid = frm.fields_dict.items.grid;\n\n            // faqat yashiramiz\n            grid.update_docfield_property(\"schedule_date\", \"hidden\", 1);\n            grid.update_docfield_property(\"schedule_date\", \"reqd\", 0);\n\n            grid.refresh();\n        }\n    }\n});\n\n",
  "view": "Form"
 }
]