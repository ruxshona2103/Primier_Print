[
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Stock Entry",
  "enabled": 1,
  "modified": "2025-12-23 10:41:44.797029",
  "module": null,
  "name": "Stock Entry - Custom Logic",
  "script": "\nfrappe.ui.form.on('Stock Entry', {\n\tonload: function(frm) {\n\t\t// Stock Entry Type ni filtrlash (Faqat kerakli 3 ta)\n\t\tfrm.set_query('stock_entry_type', function() {\n\t\t\treturn {\n\t\t\t\tfilters: {\n\t\t\t\t\t'name': ['in', ['Услуги по заказу', 'Расход по заказу', 'Перемещение']]\n\t\t\t\t}\n\t\t\t};\n\t\t});\n\t},\n\n\trefresh: function(frm) {\n\t\t// Har safar ochilganda UI rules ni qo'llash\n\t\tapply_ui_rules(frm);\n\t},\n\n\tstock_entry_type: function(frm) {\n\t\t// Type o'zgarganda UI rules ni qo'llash\n\t\tapply_ui_rules(frm);\n\t},\n\n\tcustom_sales_order: function(frm) {\n\t\t// Sales Order o'zgarganda Sales Order Item ni tozalash\n\t\tfrm.set_value('custom_sales_order_item', '');\n\n\t\t// Sales Order Item uchun query filtri\n\t\tif (frm.doc.custom_sales_order) {\n\t\t\tfrm.set_query('custom_sales_order_item', function() {\n\t\t\t\treturn {\n\t\t\t\t\tquery: 'premierprint.utils.stock_entry.get_sales_order_items_query',\n\t\t\t\t\tfilters: {\n\t\t\t\t\t\tsales_order: frm.doc.custom_sales_order\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t});\n\t\t}\n\t},\n\n\tcustom_sales_order_item: function(frm) {\n\t\t// Sales Order Item tanlanganda BOM materiallarini yuklash\n\t\tif (frm.doc.custom_sales_order_item) {\n\t\t\tfrappe.call({\n\t\t\t\tmethod: 'premierprint.utils.stock_entry.get_bom_materials',\n\t\t\t\targs: {\n\t\t\t\t\tsales_order_item_id: frm.doc.custom_sales_order_item\n\t\t\t\t},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tif (r.message) {\n\t\t\t\t\t\t// Avvalgi itemlarni tozalash\n\t\t\t\t\t\tfrm.clear_table('items');\n\n\t\t\t\t\t\t// Yangi materiallarni qo'shish\n\t\t\t\t\t\tr.message.forEach(function(item) {\n\t\t\t\t\t\t\tlet row = frm.add_child('items');\n\t\t\t\t\t\t\trow.item_code = item.item_code;\n\t\t\t\t\t\t\trow.item_name = item.item_name;\n\t\t\t\t\t\t\trow.description = item.description;\n\t\t\t\t\t\t\trow.qty = item.qty;\n\t\t\t\t\t\t\trow.uom = item.uom;\n\t\t\t\t\t\t\trow.stock_uom = item.stock_uom;\n\t\t\t\t\t\t\trow.conversion_factor = item.conversion_factor;\n\t\t\t\t\t\t\trow.s_warehouse = item.s_warehouse;\n\t\t\t\t\t\t\trow.cost_center = item.cost_center;\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tfrm.refresh_field('items');\n\n\t\t\t\t\t\t// Warehouse o'zgarganda Cost Center avtomatik qo'yish\n\t\t\t\t\t\tsetup_warehouse_change_handler(frm);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n});\n\n// Items jadvalida warehouse o'zgarganda\nfrappe.ui.form.on('Stock Entry Detail', {\n\ts_warehouse: function(frm, cdt, cdn) {\n\t\tauto_set_cost_center(frm, cdt, cdn, 's_warehouse');\n\t},\n\n\tt_warehouse: function(frm, cdt, cdn) {\n\t\tauto_set_cost_center(frm, cdt, cdn, 't_warehouse');\n\t}\n});\n\nfunction apply_ui_rules(frm) {\n\tconst entry_type = frm.doc.stock_entry_type;\n\n\tif (entry_type === 'Услуги по заказу') {\n\t\t// A) Услуги по заказу - Narx ko'rinadi va o'zgartiriladi\n\n\t\t// Supplier maydoni - Ko'rinsin va majburiy\n\t\tfrm.set_df_property('custom_supplier', 'hidden', 0);\n\t\tfrm.set_df_property('custom_supplier', 'reqd', 1);\n\n\t\t// From/To Sub Company - Yashirilsin\n\t\tfrm.set_df_property('custom_from_sub_company', 'hidden', 1);\n\t\tfrm.set_df_property('custom_to_sub_company', 'hidden', 1);\n\t\tfrm.set_df_property('custom_from_sub_company', 'reqd', 0);\n\t\tfrm.set_df_property('custom_to_sub_company', 'reqd', 0);\n\n\t\t// Items jadvalida narx (basic_rate) - Ko'rinsin va o'zgartirilsin\n\t\tfrm.fields_dict.items.grid.update_docfield_property('basic_rate', 'hidden', 0);\n\t\tfrm.fields_dict.items.grid.update_docfield_property('basic_rate', 'read_only', 0);\n\t\tfrm.fields_dict.items.grid.update_docfield_property('amount', 'hidden', 0);\n\n\t} else if (entry_type === 'Расход по заказу') {\n\t\t// B) Расход по заказу - Narx butunlay yashiriladi\n\n\t\t// Supplier - Yashirilsin\n\t\tfrm.set_df_property('custom_supplier', 'hidden', 1);\n\t\tfrm.set_df_property('custom_supplier', 'reqd', 0);\n\n\t\t// From/To Sub Company - Yashirilsin\n\t\tfrm.set_df_property('custom_from_sub_company', 'hidden', 1);\n\t\tfrm.set_df_property('custom_to_sub_company', 'hidden', 1);\n\t\tfrm.set_df_property('custom_from_sub_company', 'reqd', 0);\n\t\tfrm.set_df_property('custom_to_sub_company', 'reqd', 0);\n\n\t\t// Items jadvalida narx (basic_rate, amount) - Butunlay yashirilsin\n\t\tfrm.fields_dict.items.grid.update_docfield_property('basic_rate', 'hidden', 1);\n\t\tfrm.fields_dict.items.grid.update_docfield_property('amount', 'hidden', 1);\n\n\t} else if (entry_type === 'Перемещение') {\n\t\t// C) Перемещение - Narx ko'rinadi lekin o'zgartirib bo'lmaydi\n\n\t\t// Supplier - Yashirilsin\n\t\tfrm.set_df_property('custom_supplier', 'hidden', 1);\n\t\tfrm.set_df_property('custom_supplier', 'reqd', 0);\n\n\t\t// From/To Sub Company - Ko'rinsin va majburiy\n\t\tfrm.set_df_property('custom_from_sub_company', 'hidden', 0);\n\t\tfrm.set_df_property('custom_to_sub_company', 'hidden', 0);\n\t\tfrm.set_df_property('custom_from_sub_company', 'reqd', 1);\n\t\tfrm.set_df_property('custom_to_sub_company', 'reqd', 1);\n\n\t\t// Items jadvalida narx (basic_rate) - Ko'rinsin lekin o'zgarmasin\n\t\tfrm.fields_dict.items.grid.update_docfield_property('basic_rate', 'hidden', 0);\n\t\tfrm.fields_dict.items.grid.update_docfield_property('basic_rate', 'read_only', 1);\n\t\tfrm.fields_dict.items.grid.update_docfield_property('amount', 'hidden', 0);\n\n\t} else {\n\t\t// D) Boshqa turlar uchun - Default holatga qaytarish\n\t\tfrm.set_df_property('custom_supplier', 'hidden', 1);\n\t\tfrm.set_df_property('custom_supplier', 'reqd', 0);\n\t\tfrm.set_df_property('custom_from_sub_company', 'hidden', 1);\n\t\tfrm.set_df_property('custom_to_sub_company', 'hidden', 1);\n\t\tfrm.set_df_property('custom_from_sub_company', 'reqd', 0);\n\t\tfrm.set_df_property('custom_to_sub_company', 'reqd', 0);\n\n\t\tfrm.fields_dict.items.grid.update_docfield_property('basic_rate', 'hidden', 0);\n\t\tfrm.fields_dict.items.grid.update_docfield_property('basic_rate', 'read_only', 0);\n\t\tfrm.fields_dict.items.grid.update_docfield_property('amount', 'hidden', 0);\n\t}\n\n\tfrm.refresh_field('items');\n}\n\nfunction setup_warehouse_change_handler(frm) {\n\t// Items jadvalida warehouse o'zgarganda Cost Center avtomatik qo'yish\n\tfrm.fields_dict.items.grid.grid_rows.forEach(function(row) {\n\t\tif (row.doc) {\n\t\t\tauto_set_cost_center_from_warehouse(row.doc);\n\t\t}\n\t});\n}\n\nfunction auto_set_cost_center(frm, cdt, cdn, warehouse_field) {\n\tlet row = locals[cdt][cdn];\n\tauto_set_cost_center_from_warehouse(row);\n\tfrm.refresh_field('items');\n}\n\nfunction auto_set_cost_center_from_warehouse(row) {\n\t// S_warehouse yoki T_warehouse dan Cost Center aniqlash\n\tlet warehouse = row.s_warehouse || row.t_warehouse;\n\n\tif (warehouse) {\n\t\tlet warehouse_lower = warehouse.toLowerCase();\n\n\t\t// Ombor nomida \"poli\" so'zi bo'lsa -> 100\n\t\tif (warehouse_lower.includes('poli')) {\n\t\t\trow.cost_center = '100 - Poligrafiya Department';\n\t\t}\n\t\t// Ombor nomida \"reklama\" so'zi bo'lsa -> 200\n\t\telse if (warehouse_lower.includes('reklama')) {\n\t\t\trow.cost_center = '200 - Reklama Department';\n\t\t}\n\t\t// Ombor nomida \"suvenir\" so'zi bo'lsa -> 300\n\t\telse if (warehouse_lower.includes('suvenir')) {\n\t\t\trow.cost_center = '300 - Suvenir Department';\n\t\t}\n\t\t// Default\n\t\telse {\n\t\t\trow.cost_center = '100 - Poligrafiya Department';\n\t\t}\n\t}\n}\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Stock Entry",
  "enabled": 1,
  "modified": "2025-12-22 16:20:41.759048",
  "module": null,
  "name": "Stock Entry - hide options",
  "script": "frappe.ui.form.on('Stock Entry', {\n    // 1. SETUP: Form ochilishi bilan filtrlarni o'rnatamiz\n    setup: function(frm) {\n        frm.set_query('stock_entry_type', function() {\n            return {\n                filters: [\n                    ['Stock Entry Type', 'name', 'in', ['Расход по заказу', 'Услуги по заказу', 'Перемещение']]\n                ]\n            };\n        });\n    },\n\n    // 2. REFRESH: Form yuklanganda logikani ishlatamiz\n    refresh: function(frm) {\n        frm.trigger('apply_ui_rules');\n    },\n\n    // 3. O'ZGARISH: Tip o'zgarganda logikani ishlatamiz\n    stock_entry_type: function(frm) {\n        frm.trigger('apply_ui_rules');\n    },\n\n    // 4. MANTIQ MARKAZI\n    apply_ui_rules: function(frm) {\n        let type = frm.doc.stock_entry_type;\n\n        // Reset (Avval hammasini tozalaymiz/yashiramiz)\n        // Bu juda muhim, aks holda eski holat qotib qoladi\n        frm.set_df_property('custom_supplier', 'hidden', 1);\n        frm.set_df_property('custom_supplier', 'reqd', 0);\n        frm.fields_dict['items'].grid.update_docfield_property('basic_rate', 'hidden', 0);\n        frm.fields_dict['items'].grid.update_docfield_property('basic_rate', 'read_only', 0);\n        frm.fields_dict['items'].grid.update_docfield_property('amount', 'hidden', 0);\n\n        // A) \"Услуги по заказу\"\n        if (type === 'Услуги по заказу') {\n            // Supplier majburiy\n            frm.set_df_property('custom_supplier', 'hidden', 0);\n            frm.set_df_property('custom_supplier', 'reqd', 1);\n        } \n        \n        // B) \"Расход по заказу\"\n        else if (type === 'Расход по заказу') {\n            // Narxlar yashirinadi (Maxfiylik)\n            frm.fields_dict['items'].grid.update_docfield_property('basic_rate', 'hidden', 1);\n            frm.fields_dict['items'].grid.update_docfield_property('amount', 'hidden', 1);\n        } \n        \n        // C) \"Перемещение\" (Yangi qo'shilgan)\n        else if (type === 'Перемещение') {\n            // Narx ko'rinsin, lekin o'zgartirib bo'lmasin\n            frm.fields_dict['items'].grid.update_docfield_property('basic_rate', 'read_only', 1);\n        }\n        \n        // Jadvalni yangilash\n        frm.refresh_field('items');\n    }\n});",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Stock Entry",
  "enabled": 1,
  "modified": "2025-12-22 17:12:39.108549",
  "module": null,
  "name": "stock entry - add item",
  "script": "frappe.ui.form.on('Stock Entry', {\n    setup: function(frm) {\n        // 1. Stock Entry Type filtri\n        frm.set_query('stock_entry_type', function() {\n            return {\n                filters: [\n                    ['Stock Entry Type', 'name', 'in', ['Расход по заказу', 'Услуги по заказу', 'Перемещение']]\n                ]\n            };\n        });\n\n        // 2. Sales Order Item Query (BOM uchun)\n        frm.set_query(\"custom_sales_order_item\", function() {\n            let so_id = frm.doc.custom_sales_order;\n            if (!so_id) return { filters: { \"parent\": \"null\" } };\n            return {\n                query: \"premierprint.premierprint.utils.stock_entry.get_sales_order_items_query\",\n                filters: { \"sales_order\": so_id }\n            };\n        });\n\n        // 3. Omborlarni Filtrlash (JADVAL ICHIDA)\n        frm.set_query(\"s_warehouse\", \"items\", function(doc, cdt, cdn) {\n            if (frm.doc.stock_entry_type === 'Перемещение' && frm.doc.custom_from_sub_company) {\n                return get_warehouse_filter(frm.doc.custom_from_sub_company);\n            }\n        });\n\n        frm.set_query(\"t_warehouse\", \"items\", function(doc, cdt, cdn) {\n            if (frm.doc.stock_entry_type === 'Перемещение' && frm.doc.custom_to_sub_company) {\n                return get_warehouse_filter(frm.doc.custom_to_sub_company);\n            }\n        });\n    },\n\n    refresh: function(frm) {\n        frm.trigger('apply_ui_rules');\n    },\n\n    stock_entry_type: function(frm) {\n        frm.trigger('apply_ui_rules');\n    },\n\n    // Sub Company o'zgarganda filtrlarni yangilash\n    custom_from_sub_company: function(frm) { frm.refresh_field('items'); },\n    custom_to_sub_company: function(frm) { frm.refresh_field('items'); },\n\n    // Sales Order o'zgarganda\n    custom_sales_order: function(frm) {\n        frm.set_value(\"custom_sales_order_item\", \"\");\n        frm.clear_table(\"items\");\n        frm.refresh_field(\"items\");\n    },\n\n    // Item tanlanganda (BOM yuklash)\n    custom_sales_order_item: function(frm) {\n        if (frm.doc.custom_sales_order_item) {\n            frm.clear_table(\"items\");\n            frm.refresh_field(\"items\");\n\n            frappe.call({\n                method: \"premierprint.premierprint.utils.stock_entry.get_bom_materials\",\n                args: { sales_order_item_id: frm.doc.custom_sales_order_item },\n                freeze: true,\n                callback: function(r) {\n                    if (r.message && r.message.length > 0) {\n                        r.message.forEach(row => {\n                            let child = frm.add_child(\"items\");\n                            frappe.model.set_value(child.doctype, child.name, row);\n                        });\n                        frm.refresh_field(\"items\");\n                    }\n                    frm.trigger('apply_ui_rules'); // UI qoidalarini qayta qo'llash\n                }\n            });\n        }\n    },\n\n    // --- UI MANTIQ MARKAZI ---\n    apply_ui_rules: function(frm) {\n        let type = frm.doc.stock_entry_type;\n\n        // RESET\n        frm.set_df_property('custom_supplier', 'hidden', 1);\n        frm.set_df_property('custom_supplier', 'reqd', 0);\n        frm.set_df_property('custom_from_sub_company', 'hidden', 1);\n        frm.set_df_property('custom_to_sub_company', 'hidden', 1);\n        frm.set_df_property('custom_from_sub_company', 'reqd', 0);\n        frm.set_df_property('custom_to_sub_company', 'reqd', 0);\n        frm.fields_dict['items'].grid.update_docfield_property('basic_rate', 'hidden', 0);\n        frm.fields_dict['items'].grid.update_docfield_property('basic_rate', 'read_only', 1);\n        frm.fields_dict['items'].grid.update_docfield_property('amount', 'hidden', 0);\n\n        // LOGIKA\n        if (type === 'Услуги по заказу') {\n            frm.set_df_property('custom_supplier', 'hidden', 0);\n            frm.set_df_property('custom_supplier', 'reqd', 1);\n            frm.fields_dict['items'].grid.update_docfield_property('basic_rate', 'read_only', 0);\n        } \n        else if (type === 'Расход по заказу') {\n            frm.fields_dict['items'].grid.update_docfield_property('basic_rate', 'hidden', 1);\n            frm.fields_dict['items'].grid.update_docfield_property('amount', 'hidden', 1);\n        } \n        else if (type === 'Перемещение') {\n            frm.set_df_property('custom_from_sub_company', 'hidden', 0);\n            frm.set_df_property('custom_to_sub_company', 'hidden', 0);\n            frm.set_df_property('custom_from_sub_company', 'reqd', 1);\n            frm.set_df_property('custom_to_sub_company', 'reqd', 1);\n        }\n        \n        frm.refresh_field('items');\n    }\n});\n\n// YORDAMCHI FUNKSIYALAR\nfunction get_warehouse_filter(sub_company) {\n    let filter_txt = \"\";\n    if (sub_company === \"Полиграфия\") filter_txt = \"Poli\";\n    else if (sub_company === \"Реклама\") filter_txt = \"Reklama\";\n    else if (sub_company === \"Сувенир\") filter_txt = \"Suvenir\";\n\n    return { filters: [['Warehouse', 'name', 'like', '%' + filter_txt + '%']] };\n}\n\nfrappe.ui.form.on('Stock Entry Detail', {\n    s_warehouse: function(frm, cdt, cdn) {\n        let row = locals[cdt][cdn];\n        if (row.s_warehouse) set_cost_center(frm, row);\n    },\n    t_warehouse: function(frm, cdt, cdn) {\n        let row = locals[cdt][cdn];\n        if (row.t_warehouse) set_cost_center(frm, row);\n    }\n});\n\nfunction set_cost_center(frm, row) {\n    let warehouse = row.s_warehouse || row.t_warehouse;\n    if (!warehouse) return;\n\n    if (warehouse.includes(\"Poli\")) {\n        frappe.model.set_value(row.doctype, row.name, \"cost_center\", \"100 - Poligrafiya Department\");\n    } else if (warehouse.includes(\"Reklama\")) {\n        frappe.model.set_value(row.doctype, row.name, \"cost_center\", \"200 - Reklama Department\");\n    } else if (warehouse.includes(\"Suvenir\")) {\n        frappe.model.set_value(row.doctype, row.name, \"cost_center\", \"300 - Suvenir Department\");\n    }\n}",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Purchase Order",
  "enabled": 1,
  "modified": "2025-12-16 17:45:03.598740",
  "module": "Primier Print",
  "name": "Purchase Order",
  "script": "frappe.ui.form.on(\"Purchase Order\", {\n    before_save(frm) {\n        (frm.doc.items || []).forEach(row => {\n            if (!row.schedule_date) {\n                row.schedule_date = frappe.datetime.get_today();\n            }\n        });\n    },\n\n    refresh(frm) {\n        if (frm.fields_dict.items?.grid) {\n            const grid = frm.fields_dict.items.grid;\n\n            // faqat yashiramiz\n            grid.update_docfield_property(\"schedule_date\", \"hidden\", 1);\n            grid.update_docfield_property(\"schedule_date\", \"reqd\", 0);\n\n            grid.refresh();\n        }\n    }\n});\n\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Stock Entry",
  "enabled": 1,
  "modified": "2025-12-24 08:19:36.733755",
  "module": null,
  "name": "Stock Entry - Optimized Logic",
  "script": "frappe.ui.form.on('Stock Entry', {\n\t// ==================== INITIALIZATION ====================\n\tsetup: function(frm) {\n\t\t// 1. Stock Entry Type ni filtrlash (faqat 3 ta tur)\n\t\tfrm.set_query('stock_entry_type', function() {\n\t\t\treturn {\n\t\t\t\tfilters: [\n\t\t\t\t\t['Stock Entry Type', 'name', 'in', ['Расход по заказу', 'Услуги по заказу', 'Перемещение']]\n\t\t\t\t]\n\t\t\t};\n\t\t});\n\n\t\t// 2. Sales Order Item uchun query (BOM explosion uchun)\n\t\tfrm.set_query('custom_sales_order_item', function() {\n\t\t\tif (!frm.doc.custom_sales_order) {\n\t\t\t\treturn { filters: { 'parent': 'null' } };\n\t\t\t}\n\t\t\treturn {\n\t\t\t\tquery: 'premierprint.utils.stock_entry.get_sales_order_items_query',\n\t\t\t\tfilters: { 'sales_order': frm.doc.custom_sales_order }\n\t\t\t};\n\t\t});\n\n\t\t// 3. Omborlarni filtrlash (Перемещение uchun)\n\t\tfrm.set_query('s_warehouse', 'items', function(doc) {\n\t\t\tif (doc.stock_entry_type === 'Перемещение' && doc.custom_from_sub_company) {\n\t\t\t\treturn get_warehouse_filter(doc.custom_from_sub_company);\n\t\t\t}\n\t\t});\n\n\t\tfrm.set_query('t_warehouse', 'items', function(doc) {\n\t\t\tif (doc.stock_entry_type === 'Перемещение' && doc.custom_to_sub_company) {\n\t\t\t\treturn get_warehouse_filter(doc.custom_to_sub_company);\n\t\t\t}\n\t\t});\n\t},\n\n\t// ==================== REFRESH & TYPE CHANGE ====================\n\trefresh: function(frm) {\n\t\tapply_ui_rules(frm);\n\t},\n\n\tstock_entry_type: function(frm) {\n\t\tapply_ui_rules(frm);\n\t},\n\n\t// ==================== SUB COMPANY CHANGE ====================\n\tcustom_from_sub_company: function(frm) {\n\t\tfrm.refresh_field('items');\n\t},\n\n\tcustom_to_sub_company: function(frm) {\n\t\tfrm.refresh_field('items');\n\t},\n\n\t// ==================== SALES ORDER CHANGE ====================\n\tcustom_sales_order: function(frm) {\n\t\t// Sales Order o'zgarganda itemlarni va sales_order_item ni tozalash\n\t\tfrm.set_value('custom_sales_order_item', '');\n\t\tfrm.clear_table('items');\n\t\tfrm.refresh_field('items');\n\t},\n\n\t// ==================== BOM EXPLOSION ====================\n\tcustom_sales_order_item: function(frm) {\n\t\tif (!frm.doc.custom_sales_order_item) return;\n\n\t\t// Avvalgi itemlarni tozalash\n\t\tfrm.clear_table('items');\n\t\tfrm.refresh_field('items');\n\n\t\t// BOM materiallarini yuklash\n\t\tfrappe.call({\n\t\t\tmethod: 'premierprint.utils.stock_entry.get_bom_materials',\n\t\t\targs: { sales_order_item_id: frm.doc.custom_sales_order_item },\n\t\t\tfreeze: true,\n\t\t\tfreeze_message: __('BOM materiallarini yuklamoqda...'),\n\t\t\tcallback: function(r) {\n\t\t\t\tif (r.message && r.message.length > 0) {\n\t\t\t\t\tr.message.forEach(function(material) {\n\t\t\t\t\t\tlet row = frm.add_child('items');\n\t\t\t\t\t\tfrappe.model.set_value(row.doctype, row.name, material);\n\t\t\t\t\t});\n\t\t\t\t\tfrm.refresh_field('items');\n\t\t\t\t\tfrappe.show_alert({\n\t\t\t\t\t\tmessage: __('BOM materiallar muvaffaqiyatli yuklandi!'),\n\t\t\t\t\t\tindicator: 'green'\n\t\t\t\t\t}, 3);\n\t\t\t\t} else {\n\t\t\t\t\tfrappe.msgprint(__('BOM materiallari topilmadi!'));\n\t\t\t\t}\n\n\t\t\t\t// UI qoidalarini qayta qo'llash\n\t\t\t\tapply_ui_rules(frm);\n\t\t\t}\n\t\t});\n\t}\n});\n\n// ==================== CHILD TABLE EVENTS ====================\nfrappe.ui.form.on('Stock Entry Detail', {\n\ts_warehouse: function(frm, cdt, cdn) {\n\t\tauto_set_cost_center(frm, cdt, cdn);\n\t},\n\n\tt_warehouse: function(frm, cdt, cdn) {\n\t\tauto_set_cost_center(frm, cdt, cdn);\n\t}\n});\n\n// ==================== HELPER FUNCTIONS ====================\n\n/**\n * UI qoidalarini qo'llash (3 ta ssenariy uchun)\n */\nfunction apply_ui_rules(frm) {\n\tconst type = frm.doc.stock_entry_type;\n\n\t// RESET: Avval barcha maydonlarni default holatga qaytarish\n\treset_ui_fields(frm);\n\n\t// SSENARIY 1: Расход по заказу (Narxlar yashiriladi)\n\tif (type === 'Расход по заказу') {\n\t\t// Supplier va Sub Company maydonlari yashirin\n\t\tfrm.set_df_property('custom_supplier', 'hidden', 1);\n\t\tfrm.set_df_property('custom_supplier', 'reqd', 0);\n\t\tfrm.set_df_property('custom_from_sub_company', 'hidden', 1);\n\t\tfrm.set_df_property('custom_to_sub_company', 'hidden', 1);\n\t\tfrm.set_df_property('custom_from_sub_company', 'reqd', 0);\n\t\tfrm.set_df_property('custom_to_sub_company', 'reqd', 0);\n\n\t\t// Narxlarni yashirish (maxfiylik uchun)\n\t\tfrm.fields_dict.items.grid.update_docfield_property('basic_rate', 'hidden', 1);\n\t\tfrm.fields_dict.items.grid.update_docfield_property('amount', 'hidden', 1);\n\t}\n\n\t// SSENARIY 2: Услуги по заказу (Narxlar ochiq va tahrirlash mumkin)\n\telse if (type === 'Услуги по заказу') {\n\t\t// Supplier ko'rinadi va majburiy\n\t\tfrm.set_df_property('custom_supplier', 'hidden', 0);\n\t\tfrm.set_df_property('custom_supplier', 'reqd', 1);\n\n\t\t// Sub Company maydonlari yashirin\n\t\tfrm.set_df_property('custom_from_sub_company', 'hidden', 1);\n\t\tfrm.set_df_property('custom_to_sub_company', 'hidden', 1);\n\t\tfrm.set_df_property('custom_from_sub_company', 'reqd', 0);\n\t\tfrm.set_df_property('custom_to_sub_company', 'reqd', 0);\n\n\t\t// Narxlarni ko'rsatish va tahrirlash mumkin\n\t\tfrm.fields_dict.items.grid.update_docfield_property('basic_rate', 'hidden', 0);\n\t\tfrm.fields_dict.items.grid.update_docfield_property('basic_rate', 'read_only', 0);\n\t\tfrm.fields_dict.items.grid.update_docfield_property('amount', 'hidden', 0);\n\t}\n\n\t// SSENARIY 3: Перемещение (Narxlar ko'rinadi lekin read-only)\n\telse if (type === 'Перемещение') {\n\t\t// Supplier yashirin\n\t\tfrm.set_df_property('custom_supplier', 'hidden', 1);\n\t\tfrm.set_df_property('custom_supplier', 'reqd', 0);\n\n\t\t// Sub Company maydonlari ko'rinadi va majburiy\n\t\tfrm.set_df_property('custom_from_sub_company', 'hidden', 0);\n\t\tfrm.set_df_property('custom_to_sub_company', 'hidden', 0);\n\t\tfrm.set_df_property('custom_from_sub_company', 'reqd', 1);\n\t\tfrm.set_df_property('custom_to_sub_company', 'reqd', 1);\n\n\t\t// Narxlar ko'rinadi lekin o'zgartirib bo'lmaydi\n\t\tfrm.fields_dict.items.grid.update_docfield_property('basic_rate', 'hidden', 0);\n\t\tfrm.fields_dict.items.grid.update_docfield_property('basic_rate', 'read_only', 1);\n\t\tfrm.fields_dict.items.grid.update_docfield_property('amount', 'hidden', 0);\n\t}\n\n\t// Jadval refresh\n\tfrm.refresh_field('items');\n}\n\n/**\n * Barcha UI maydonlarni default holatga qaytarish\n */\nfunction reset_ui_fields(frm) {\n\tfrm.set_df_property('custom_supplier', 'hidden', 1);\n\tfrm.set_df_property('custom_supplier', 'reqd', 0);\n\tfrm.set_df_property('custom_from_sub_company', 'hidden', 1);\n\tfrm.set_df_property('custom_to_sub_company', 'hidden', 1);\n\tfrm.set_df_property('custom_from_sub_company', 'reqd', 0);\n\tfrm.set_df_property('custom_to_sub_company', 'reqd', 0);\n\n\tfrm.fields_dict.items.grid.update_docfield_property('basic_rate', 'hidden', 0);\n\tfrm.fields_dict.items.grid.update_docfield_property('basic_rate', 'read_only', 0);\n\tfrm.fields_dict.items.grid.update_docfield_property('amount', 'hidden', 0);\n}\n\n/**\n * Warehouse filtri (Sub Company asosida)\n */\nfunction get_warehouse_filter(sub_company) {\n\tlet warehouse_keyword = '';\n\n\tif (sub_company === 'Полиграфия') {\n\t\twarehouse_keyword = 'Poli';\n\t} else if (sub_company === 'Реклама') {\n\t\twarehouse_keyword = 'Reklama';\n\t} else if (sub_company === 'Сувенир') {\n\t\twarehouse_keyword = 'Suvenir';\n\t}\n\n\treturn {\n\t\tfilters: [\n\t\t\t['Warehouse', 'name', 'like', '%' + warehouse_keyword + '%']\n\t\t]\n\t};\n}\n\n/**\n * Cost Center avtomatik qo'yish (Warehouse nomiga qarab)\n */\nfunction auto_set_cost_center(frm, cdt, cdn) {\n\tlet row = locals[cdt][cdn];\n\tlet warehouse = row.s_warehouse || row.t_warehouse;\n\n\tif (!warehouse) return;\n\n\tlet cost_center = '';\n\tlet warehouse_lower = warehouse.toLowerCase();\n\n\t// Warehouse nomidan Cost Center aniqlash\n\tif (warehouse_lower.includes('poli')) {\n\t\tcost_center = '100 - Poligrafiya Department';\n\t} else if (warehouse_lower.includes('reklama')) {\n\t\tcost_center = '200 - Reklama Department';\n\t} else if (warehouse_lower.includes('suvenir')) {\n\t\tcost_center = '300 - Suvenir Department';\n\t} else {\n\t\tcost_center = '100 - Poligrafiya Department'; // Default\n\t}\n\n\t// Cost Center qo'yish\n\tfrappe.model.set_value(row.doctype, row.name, 'cost_center', cost_center);\n}\n",
  "view": "Form"
 }
]